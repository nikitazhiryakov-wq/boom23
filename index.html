<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flappy Crash - Collector Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #311b92 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .game-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            overflow: hidden;
            max-width: 900px;
            width: 100%;
        }
        
        .game-header {
            background: linear-gradient(90deg, #FF9800, #FFB74D);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 15px;
            background: #f5f5f5;
            border-bottom: 2px solid #ddd;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2196F3;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #666;
        }
        
        .game-area {
            position: relative;
            height: 450px;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FF);
            overflow: hidden;
        }
        
        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        
        .multiplier-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #FFD700;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1.8em;
            font-weight: bold;
            z-index: 50;
            min-width: 150px;
            text-align: center;
            border: 3px solid #FF9800;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .collector-status {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 152, 0, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 50;
            font-size: 1.1em;
            min-width: 180px;
            text-align: center;
            border: 2px solid #FFD700;
        }
        
        .collector-status.collected {
            background: rgba(76, 175, 80, 0.9);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .game-over-panel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            text-align: center;
            display: none;
            z-index: 100;
            min-width: 320px;
            border: 3px solid #2196F3;
        }
        
        .win-amount {
            font-size: 2.5em;
            font-weight: bold;
            color: #4CAF50;
            margin: 20px 0;
        }
        
        .btn-restart {
            padding: 12px 30px;
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }
        
        .btn-restart:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .info-panel {
            padding: 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        
        .skill-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .skill-btn {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .skill-btn.active {
            background: #2196F3;
            color: white;
            border-color: #1976D2;
        }
        
        .instructions {
            text-align: center;
            color: #666;
            margin-top: 15px;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .stats-bar {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .multiplier-display {
                font-size: 1.4em;
                min-width: 120px;
            }
            
            .collector-status {
                font-size: 0.9em;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üéÆ Flappy Crash: Collector Edition</h1>
            <p>–°–æ–±–µ—Ä–∏ –ø–æ–¥–∫–æ–≤—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—ã–∏–≥—Ä—ã—à!</p>
        </div>
        
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="currentMultiplier">1.00x</div>
                <div class="stat-label">–ú–Ω–æ–∂–∏—Ç–µ–ª—å</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="playerSkill">0.85</div>
                <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalWins">0</div>
                <div class="stat-label">–í—ã–∏–≥—Ä—ã—à–µ–π</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalCoins">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –º–æ–Ω–µ—Ç</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="gameTime">0.0</div>
                <div class="stat-label">–í—Ä–µ–º—è (—Å–µ–∫)</div>
            </div>
        </div>
        
        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
            
            <div class="multiplier-display">
                ü™ô √ó <span id="multiplierValue">1.00</span>
            </div>
            
            <div class="collector-status" id="collectorStatus">
                üß≤ –ü–æ–¥–∫–æ–≤–∞: –û–∂–∏–¥–∞–Ω–∏–µ
            </div>
            
            <div id="gameOverPanel" class="game-over-panel">
                <h2 id="resultTitle">–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
                <div class="win-amount" id="winAmount">0x</div>
                <p id="resultMessage">–°–æ–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–æ–≤—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—ã–∏–≥—Ä—ã—à–∞!</p>
                <button class="btn-restart" onclick="startNewGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="skill-selector">
                <span>–£—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞:</span>
                <button class="skill-btn active" onclick="changeSkill(0.5)">–ù–æ–≤–∏—á–æ–∫ (0.5)</button>
                <button class="skill-btn" onclick="changeSkill(0.85)">–°—Ä–µ–¥–Ω–∏–π (0.85)</button>
                <button class="skill-btn" onclick="changeSkill(1.0)">–ü—Ä–æ—Ñ–∏ (1.0)</button>
            </div>
            
            <div class="instructions">
                <p>üéØ <strong>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</strong> –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ç–∏—á–∫–æ–π (–∫–ª–∏–∫/–ø—Ä–æ–±–µ–ª), –∏–∑–±–µ–≥–∞–π—Ç–µ —Ç—Ä—É–±.</p>
                <p>üåü <strong>–°–æ–±–µ—Ä–∏—Ç–µ –∑–æ–ª–æ—Ç—É—é –ø–æ–¥–∫–æ–≤—É</strong>, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à!</p>
                <p>üí∞ –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –ø–æ–¥–∫–æ–≤—ã, –ø—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å.</p>
                <p>üèÜ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à: 200√ó (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏)</p>
            </div>
        </div>
    </div>

    <script>
        // ====================
        // –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ê–†–ê–ú–ï–¢–†–´
        // ====================
        const K = 1.0; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        const MAX_MULTIPLIER = 200; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å
        const BET_AMOUNT = 100; // –°—Ç–∞–≤–∫–∞
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ—Å—Ç–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è
        const GROWTH_RATE = 0.15; // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–æ—Å—Ç–∞
        const BASE_TIME = 30; // –ë–∞–∑–æ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ä–æ—Å—Ç–∞
        
        // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Collector'–∞
        const COLLECTOR_SIZE = 40; // –†–∞–∑–º–µ—Ä –ø–æ–¥–∫–æ–≤—ã
        const COLLECTOR_REAPPEAR_TIME = 10; // –í—Ä–µ–º—è –¥–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è (—Å–µ–∫)
        const COLLECTOR_MIN_TIME = 5; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
        const COLLECTOR_MAX_TIME = 25; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
        
        // ====================
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ====================
        let gameState = {
            isPlaying: false,
            gameOver: false,
            gameTime: 0,
            lastTime: 0,
            
            // –ò–≥—Ä–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            currentMultiplier: 1.0,
            hiddenMaxMultiplier: 0,
            playerSkill: 0.85,
            collected: false,
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            totalWins: 0,
            totalCoins: 0,
            accumulatedWinnings: 0,
            
            // Collector
            collector: {
                x: 0,
                y: 0,
                visible: false,
                collected: false,
                timeToAppear: 0,
                reappearTimer: 0,
                nextAppearanceTime: 0
            },
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–≥—Ä—ã
            bird: { x: 100, y: 200, velocity: 0, radius: 15 },
            pipes: [],
            gameSpeed: 3,
            pipeGap: 150,
            pipeWidth: 80,
            pipeFrequency: 150,
            frameCount: 0,
            gravity: 0.5,
            jumpForce: -10
        };
        
        // ====================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // ====================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        function initGame() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
            resetGameState();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∫—Ä—ã—Ç—ã–π –ª–∏–º–∏—Ç
            gameState.hiddenMaxMultiplier = 0.5 + Math.random() * (MAX_MULTIPLIER - 0.5);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Collector
            setupCollector();
            
            updateUI();
            
            if (!gameState.isPlaying) {
                gameState.isPlaying = true;
                gameState.lastTime = Date.now();
                requestAnimationFrame(gameLoop);
            }
        }
        
        function resetGameState() {
            gameState.bird.y = canvas.height / 2;
            gameState.bird.velocity = 0;
            gameState.pipes = [];
            gameState.frameCount = 0;
            gameState.gameTime = 0;
            gameState.currentMultiplier = 1.0;
            gameState.collected = false;
            gameState.gameOver = false;
        }
        
        function setupCollector() {
            gameState.collector = {
                x: 0,
                y: 0,
                visible: false,
                collected: false,
                timeToAppear: 0,
                reappearTimer: 0,
                nextAppearanceTime: COLLECTOR_MIN_TIME + Math.random() * (COLLECTOR_MAX_TIME - COLLECTOR_MIN_TIME)
            };
            
            document.getElementById('collectorStatus').className = 'collector-status';
            document.getElementById('collectorStatus').textContent = 'üß≤ –ü–æ–¥–∫–æ–≤–∞: –û–∂–∏–¥–∞–Ω–∏–µ';
        }
        
        // ====================
        // –†–û–°–¢ –ú–ù–û–ñ–ò–¢–ï–õ–Ø (–ù–ï–õ–ò–ù–ï–ô–ù–´–ô)
        // ====================
        function updateMultiplier(deltaTime) {
            if (gameState.currentMultiplier >= gameState.hiddenMaxMultiplier) {
                // –î–æ—Å—Ç–∏–≥–ª–∏ —Å–∫—Ä—ã—Ç–æ–≥–æ –ª–∏–º–∏—Ç–∞
                gameState.currentMultiplier = gameState.hiddenMaxMultiplier;
                return;
            }
            
            if (gameState.currentMultiplier >= MAX_MULTIPLIER) {
                // –î–æ—Å—Ç–∏–≥–ª–∏ –º–∞–∫—Å–∏–º—É–º–∞
                gameState.currentMultiplier = MAX_MULTIPLIER;
                autoWin();
                return;
            }
            
            // –ù–µ–ª–∏–Ω–µ–π–Ω—ã–π —Ä–æ—Å—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
            // –§–æ—Ä–º—É–ª–∞: multiplier = 1 + (time/BASE_TIME)^GROWTH_RATE * (MAX_MULTIPLIER-1)
            const timeFactor = gameState.gameTime / BASE_TIME;
            const growthFactor = Math.pow(timeFactor, GROWTH_RATE);
            
            // –£—á–∏—Ç—ã–≤–∞–µ–º skill –∏–≥—Ä–æ–∫–∞: —á–µ–º –≤—ã—à–µ skill, —Ç–µ–º –±—ã—Å—Ç—Ä–µ–µ —Ä–æ—Å—Ç
            const skillBonus = 1 + (gameState.playerSkill - 0.5) * 0.3;
            
            const targetMultiplier = 1 + growthFactor * (MAX_MULTIPLIER - 1) * skillBonus;
            
            // –ü–ª–∞–≤–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è
            const increment = (targetMultiplier - gameState.currentMultiplier) * deltaTime * 0.5;
            gameState.currentMultiplier += increment;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º–æ–º –∏ —Å–∫—Ä—ã—Ç—ã–º –ª–∏–º–∏—Ç–æ–º
            gameState.currentMultiplier = Math.min(
                gameState.currentMultiplier,
                gameState.hiddenMaxMultiplier,
                MAX_MULTIPLIER
            );
        }
        
        // ====================
        // COLLECTOR –ú–ï–•–ê–ù–ò–ö–ê
        // ====================
        function updateCollector(deltaTime) {
            const collector = gameState.collector;
            
            if (collector.collected) {
                // –£–∂–µ —Å–æ–±—Ä–∞–ª–∏ - –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
                return;
            }
            
            if (!collector.visible) {
                // –ñ–¥–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è
                collector.timeToAppear += deltaTime;
                
                if (collector.timeToAppear >= collector.nextAppearanceTime) {
                    spawnCollector();
                }
            } else {
                // Collector –≤–∏–¥–µ–Ω - –¥–≤–∏–≥–∞–µ–º –µ–≥–æ
                collector.x -= gameState.gameSpeed * 60 * deltaTime;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∞
                if (checkCollectorCollision()) {
                    collectCollector();
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø—Ä–æ–ª–µ—Ç–µ–ª –ª–∏ –º–∏–º–æ
                if (collector.x + COLLECTOR_SIZE < gameState.bird.x && !collector.collected) {
                    // –ü—Ä–æ–ª–µ—Ç–µ–ª –º–∏–º–æ - –∏—Å—á–µ–∑–∞–µ—Ç –∏ –ø–æ—è–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                    collector.visible = false;
                    collector.timeToAppear = 0;
                    collector.reappearTimer = COLLECTOR_REAPPEAR_TIME;
                    collector.nextAppearanceTime = COLLECTOR_REAPPEAR_TIME;
                    document.getElementById('collectorStatus').textContent = 'üß≤ –ü–æ–¥–∫–æ–≤–∞: –ß–µ—Ä–µ–∑ 10—Å';
                }
                
                // –£–¥–∞–ª—è–µ–º –µ—Å–ª–∏ —É—à–µ–ª –∑–∞ —ç–∫—Ä–∞–Ω
                if (collector.x + COLLECTOR_SIZE < 0) {
                    collector.visible = false;
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–µ—Ä–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
            if (collector.reappearTimer > 0) {
                collector.reappearTimer -= deltaTime;
                if (collector.reappearTimer <= 0) {
                    collector.timeToAppear = 0;
                    collector.nextAppearanceTime = 0.1; // –ü–æ—è–≤–∏—Ç—Å—è –ø–æ—á—Ç–∏ —Å—Ä–∞–∑—É
                }
            }
        }
        
        function spawnCollector() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é –ø–æ–∑–∏—Ü–∏—é Y (–∏–∑–±–µ–≥–∞–µ–º –∫—Ä–∞–µ–≤)
            const minY = 50;
            const maxY = canvas.height - 50 - COLLECTOR_SIZE;
            const y = minY + Math.random() * (maxY - minY);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —Ç—Ä—É–± –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏
            let safePosition = true;
            for (const pipe of gameState.pipes) {
                if (pipe.x < canvas.width + 100 && pipe.x + pipe.width > canvas.width - 100) {
                    // –¢—Ä—É–±–∞ –≤ –∑–æ–Ω–µ –ø–æ—è–≤–ª–µ–Ω–∏—è Collector'–∞
                    if (y < pipe.topHeight || y + COLLECTOR_SIZE > pipe.bottomY) {
                        // –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å —Ç—Ä—É–±–æ–π - –∏—â–µ–º –¥—Ä—É–≥—É—é –ø–æ–∑–∏—Ü–∏—é
                        safePosition = false;
                        break;
                    }
                }
            }
            
            if (safePosition) {
                gameState.collector.x = canvas.width;
                gameState.collector.y = y;
                gameState.collector.visible = true;
                gameState.collector.timeToAppear = 0;
                document.getElementById('collectorStatus').textContent = 'üß≤ –ü–æ–¥–∫–æ–≤–∞: –ü–æ—è–≤–∏–ª–∞—Å—å!';
            } else {
                // –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é - –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                gameState.collector.nextAppearanceTime = 2;
            }
        }
        
        function checkCollectorCollision() {
            const bird = gameState.bird;
            const collector = gameState.collector;
            
            if (!collector.visible) return false;
            
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–º
            const closestX = Math.max(collector.x, Math.min(bird.x, collector.x + COLLECTOR_SIZE));
            const closestY = Math.max(collector.y, Math.min(bird.y, collector.y + COLLECTOR_SIZE));
            
            const distanceX = bird.x - closestX;
            const distanceY = bird.y - closestY;
            
            return (distanceX * distanceX + distanceY * distanceY) < (bird.radius * bird.radius);
        }
        
        function collectCollector() {
            gameState.collector.visible = false;
            gameState.collector.collected = true;
            gameState.collected = true;
            
            document.getElementById('collectorStatus').className = 'collector-status collected';
            document.getElementById('collectorStatus').textContent = '‚úÖ –ü–æ–¥–∫–æ–≤–∞ —Å–æ–±—Ä–∞–Ω–∞!';
            
            // –≠—Ñ—Ñ–µ–∫—Ç —Å–±–æ—Ä–∞
            showCollectorEffect();
        }
        
        function showCollectorEffect() {
            // –ü—Ä–æ—Å—Ç–æ–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç
            ctx.save();
            ctx.fillStyle = '#FFD700';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(gameState.bird.x, gameState.bird.y, 50, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
            
            // –ó–≤—É–∫–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç (–≤ —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ)
            // new Audio('collect.mp3').play();
        }
        
        // ====================
        // –ò–ì–†–û–í–û–ô –¶–ò–ö–õ
        // ====================
        function gameLoop() {
            if (!gameState.isPlaying || gameState.gameOver) {
                return;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º deltaTime
            const currentTime = Date.now();
            const deltaTime = (currentTime - gameState.lastTime) / 1000;
            gameState.lastTime = currentTime;
            const safeDeltaTime = Math.min(deltaTime, 0.1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–≥—Ä–æ–≤–æ–µ –≤—Ä–µ–º—è
            gameState.gameTime += safeDeltaTime;
            
            // –û—á–∏—Å—Ç–∫–∞ –∫–∞–Ω–≤–∞—Å–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è
            updateMultiplier(safeDeltaTime);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ñ–æ–Ω–∞
            drawBackground();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∏–∑–∏–∫–∏ –ø—Ç–∏—á–∫–∏
            updateBirdPhysics(safeDeltaTime);
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä—É–±
            updatePipes(safeDeltaTime);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Collector'–∞
            updateCollector(safeDeltaTime);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π —Å —Ç—Ä—É–±–∞–º–∏
            if (checkPipeCollisions()) {
                handleCrash();
                return;
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            drawPipes();
            drawCollector();
            drawBird();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUI();
            
            requestAnimationFrame(gameLoop);
        }
        
        function updateBirdPhysics(deltaTime) {
            gameState.bird.velocity += gameState.gravity;
            gameState.bird.y += gameState.bird.velocity * 60 * deltaTime;
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≥—Ä–∞–Ω–∏—Ü–∞–º
            if (gameState.bird.y - gameState.bird.radius < 0) {
                gameState.bird.y = gameState.bird.radius;
                gameState.bird.velocity = 0;
            }
            if (gameState.bird.y + gameState.bird.radius > canvas.height) {
                gameState.bird.y = canvas.height - gameState.bird.radius;
                gameState.bird.velocity = 0;
            }
        }
        
        function updatePipes(deltaTime) {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ç—Ä—É–±
            gameState.frameCount++;
            if (gameState.frameCount % gameState.pipeFrequency === 0) {
                createPipe();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π —Ç—Ä—É–±
            for (let i = gameState.pipes.length - 1; i >= 0; i--) {
                const pipe = gameState.pipes[i];
                pipe.x -= gameState.gameSpeed * 60 * deltaTime;
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã—à–µ–¥—à–∏—Ö –∑–∞ —ç–∫—Ä–∞–Ω
                if (pipe.x + pipe.width < 0) {
                    gameState.pipes.splice(i, 1);
                }
            }
        }
        
        function createPipe() {
            const minHeight = 50;
            const maxHeight = canvas.height - gameState.pipeGap - minHeight;
            const topHeight = minHeight + Math.random() * maxHeight;
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç skill
            const skillFactor = 0.9 + (gameState.playerSkill * 0.2);
            const adjustedGap = gameState.pipeGap * skillFactor;
            
            gameState.pipes.push({
                x: canvas.width,
                topHeight: topHeight,
                bottomY: topHeight + adjustedGap,
                width: gameState.pipeWidth
            });
        }
        
        function checkPipeCollisions() {
            const bird = gameState.bird;
            
            for (const pipe of gameState.pipes) {
                if (bird.x + bird.radius > pipe.x && 
                    bird.x - bird.radius < pipe.x + pipe.width) {
                    
                    if (bird.y - bird.radius < pipe.topHeight || 
                        bird.y + bird.radius > pipe.bottomY) {
                        return true;
                    }
                }
            }
            return false;
        }
        
        // ====================
        // –û–¢–†–ò–°–û–í–ö–ê
        // ====================
        function drawBackground() {
            // –ù–µ–±–æ
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ó–µ–º–ª—è
            ctx.fillStyle = '#8BC34A';
            ctx.fillRect(0, canvas.height - 30, canvas.width, 30);
        }
        
        function drawBird() {
            const bird = gameState.bird;
            
            // –≠—Ñ—Ñ–µ–∫—Ç –µ—Å–ª–∏ Collector —Å–æ–±—Ä–∞–Ω
            if (gameState.collected) {
                ctx.save();
                ctx.shadowColor = '#FFD700';
                ctx.shadowBlur = 15;
            }
            
            // –¢–µ–ª–æ –ø—Ç–∏—á–∫–∏
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(bird.x, bird.y, bird.radius, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–ª–∞–∑
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(bird.x + 8, bird.y - 5, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // –ö–ª—é–≤
            ctx.fillStyle = '#FF5722';
            ctx.beginPath();
            ctx.moveTo(bird.x + 15, bird.y);
            ctx.lineTo(bird.x + 25, bird.y);
            ctx.lineTo(bird.x + 15, bird.y + 8);
            ctx.fill();
            
            if (gameState.collected) {
                ctx.restore();
            }
        }
        
        function drawPipes() {
            for (const pipe of gameState.pipes) {
                // –í–µ—Ä—Ö–Ω—è—è —Ç—Ä—É–±–∞
                ctx.fillStyle = '#388E3C';
                ctx.fillRect(pipe.x, 0, pipe.width, pipe.topHeight);
                
                // –ù–∏–∂–Ω—è—è —Ç—Ä—É–±–∞
                ctx.fillStyle = '#2E7D32';
                ctx.fillRect(pipe.x, pipe.bottomY, pipe.width, canvas.height - pipe.bottomY);
                
                // –ö—Ä–∞—è —Ç—Ä—É–±
                ctx.fillStyle = '#1B5E20';
                ctx.fillRect(pipe.x - 5, pipe.topHeight - 20, pipe.width + 10, 20);
                ctx.fillRect(pipe.x - 5, pipe.bottomY, pipe.width + 10, 20);
            }
        }
        
        function drawCollector() {
            const collector = gameState.collector;
            if (!collector.visible) return;
            
            ctx.save();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
            const rotation = (Date.now() / 1000) * 2;
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ü–µ–Ω—Ç—Ä—É –ø–æ–¥–∫–æ–≤—ã
            ctx.translate(collector.x + COLLECTOR_SIZE/2, collector.y + COLLECTOR_SIZE/2);
            ctx.rotate(rotation);
            
            // –†–∏—Å—É–µ–º –ø–æ–¥–∫–æ–≤—É (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            ctx.fillStyle = '#FFD700';
            ctx.strokeStyle = '#FF9800';
            ctx.lineWidth = 4;
            
            // –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å –ø–æ–¥–∫–æ–≤—ã
            ctx.beginPath();
            ctx.arc(0, 0, COLLECTOR_SIZE/2 - 5, 0.5 * Math.PI, 2.5 * Math.PI);
            ctx.lineTo(10, -COLLECTOR_SIZE/3);
            ctx.arc(0, 0, COLLECTOR_SIZE/3, 2.5 * Math.PI, 0.5 * Math.PI, true);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // –ë–ª–µ—Å–∫
            ctx.fillStyle = '#FFF';
            ctx.globalAlpha = 0.7;
            ctx.beginPath();
            ctx.arc(-8, -8, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.restore();
        }
        
        // ====================
        // –õ–û–ì–ò–ö–ê –ò–ì–†–´
        // ====================
        function handleCrash() {
            gameState.isPlaying = false;
            gameState.gameOver = true;
            
            let winAmount = 0;
            let message = '';
            
            if (gameState.collected) {
                // –í—ã–ø–ª–∞—Ç–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ Collector'–∞
                winAmount = BET_AMOUNT * gameState.currentMultiplier;
                gameState.totalCoins += winAmount;
                gameState.accumulatedWinnings += winAmount;
                gameState.totalWins++;
                
                message = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${gameState.currentMultiplier.toFixed(2)}√ó\n–í—ã–∏–≥—Ä—ã—à: ${winAmount.toFixed(0)} –º–æ–Ω–µ—Ç!`;
                document.getElementById('resultTitle').textContent = 'üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!';
                document.getElementById('resultTitle').style.color = '#4CAF50';
            } else {
                // –ü—Ä–æ–∏–≥—Ä—ã—à –±–µ–∑ Collector'–∞
                message = '–í—ã –Ω–µ —Å–æ–±—Ä–∞–ª–∏ –ø–æ–¥–∫–æ–≤—É!\n–î–ª—è –≤—ã–∏–≥—Ä—ã—à–∞ –Ω—É–∂–Ω–æ —Å–Ω–∞—á–∞–ª–∞ —Å–æ–±—Ä–∞—Ç—å –∑–æ–ª–æ—Ç—É—é –ø–æ–¥–∫–æ–≤—É.';
                document.getElementById('resultTitle').textContent = 'üí• –í—ã –≤—Ä–µ–∑–∞–ª–∏—Å—å!';
                document.getElementById('resultTitle').style.color = '#F44336';
            }
            
            document.getElementById('winAmount').textContent = `${gameState.currentMultiplier.toFixed(2)}√ó`;
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('gameOverPanel').style.display = 'block';
            
            updateUI();
        }
        
        function autoWin() {
            if (!gameState.collected) return;
            
            gameState.isPlaying = false;
            gameState.gameOver = true;
            
            const winAmount = BET_AMOUNT * MAX_MULTIPLIER;
            gameState.totalCoins += winAmount;
            gameState.accumulatedWinnings += winAmount;
            gameState.totalWins++;
            
            document.getElementById('resultTitle').textContent = 'üèÜ –ê–í–¢–û–í–´–ò–ì–†–´–®!';
            document.getElementById('resultTitle').style.color = '#FFD700';
            document.getElementById('winAmount').textContent = `${MAX_MULTIPLIER}√ó`;
            document.getElementById('resultMessage').textContent = `–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –º–Ω–æ–∂–∏—Ç–µ–ª—å!\n–í—ã–∏–≥—Ä—ã—à: ${winAmount.toFixed(0)} –º–æ–Ω–µ—Ç!`;
            document.getElementById('gameOverPanel').style.display = 'block';
            
            updateUI();
        }
        
        // ====================
        // –ò–ù–¢–ï–†–§–ï–ô–°
        // ====================
        function updateUI() {
            // –ú–Ω–æ–∂–∏—Ç–µ–ª—å
            document.getElementById('multiplierValue').textContent = gameState.currentMultiplier.toFixed(2);
            document.getElementById('currentMultiplier').textContent = gameState.currentMultiplier.toFixed(2) + 'x';
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('playerSkill').textContent = gameState.playerSkill.toFixed(2);
            document.getElementById('totalWins').textContent = gameState.totalWins;
            document.getElementById('totalCoins').textContent = Math.floor(gameState.totalCoins);
            document.getElementById('gameTime').textContent = gameState.gameTime.toFixed(1);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤—ã–∫–∞
            document.querySelectorAll('.skill-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(`(${gameState.playerSkill})`)) {
                    btn.classList.add('active');
                }
            });
        }
        
        function changeSkill(skill) {
            gameState.playerSkill = skill;
            updateUI();
            
            if (!gameState.isPlaying) {
                startNewGame();
            } else {
                alert('–ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –Ω–∞–≤—ã–∫–∞ –≤—Å—Ç—É–ø–∏—Ç –≤ —Å–∏–ª—É –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞—É–Ω–¥–µ');
            }
        }
        
        function startNewGame() {
            document.getElementById('gameOverPanel').style.display = 'none';
            initGame();
        }
        
        // ====================
        // –£–ü–†–ê–í–õ–ï–ù–ò–ï
        // ====================
        function jump() {
            if (gameState.isPlaying && !gameState.gameOver) {
                gameState.bird.velocity = gameState.jumpForce;
            }
        }
        
        canvas.addEventListener('click', jump);
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                jump();
                e.preventDefault();
            }
        });
        
        window.addEventListener('load', initGame);
        window.addEventListener('resize', initGame);
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π
        window.startNewGame = startNewGame;
        window.changeSkill = changeSkill;
    </script>
</body>
</html>
